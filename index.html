<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Quiz Culturale Italiano Avanzato</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; margin:0; text-align:center;}
h1 { background:#0074D9;color:white;padding:20px; margin:0;}
#quiz-container { margin:20px auto; width:95%; max-width:700px; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2);}
button { padding:10px 20px;margin:10px;font-size:16px; cursor:pointer;}
.answer-btn { display:block; margin:10px auto; padding:10px; width:90%; max-width:400px; background:#0074D9;color:white; border:none; border-radius:5px;}
.answer-btn:hover { background:#005fa3;}
.correct { background:green !important; }
.wrong { background:red !important; }
#help-container { margin-top:10px; }
#timer, #tokens { font-size:18px; margin:5px; }
.hidden { display:none; }
@media (max-width:400px){ .answer-btn{width:100%; font-size:14px;} }
</style>
</head>
<body>
<h1>Quiz Culturale Italiano</h1>
<div id="quiz-container">
  <div id="menu">
    <h2>Menu Principale</h2>
    <button onclick="startQuickGame()">Partita Veloce</button>
    <button onclick="startCareer()">Carriera</button>
    <button onclick="chooseCategory()">Scegli Categoria</button>
    <button onclick="showAddQuestion()">Aggiungi Domanda</button>
  </div>

  <div id="status" class="hidden">
    <p id="timer">Tempo: 20</p>
    <p id="tokens">Gettoni: 0</p>
  </div>

  <div id="question-container"></div>

  <div id="help-container" class="hidden">
    <button onclick="useFiftyFifty()">50/50 (-20 gettoni)</button>
    <button onclick="useCorrectAnswer()">Risposta giusta (-100 gettoni)</button>
  </div>

  <div id="add-question" class="hidden">
    <h3>Aggiungi Nuova Domanda</h3>
    <label>Categoria:
      <select id="new-category">
        <option value="cultura">Cultura</option>
        <option value="storia">Storia</option>
        <option value="arte">Arte</option>
        <option value="sport">Sport</option>
        <option value="geografia">Geografia</option>
        <option value="scienza">Scienza</option>
        <option value="musica">Musica</option>
        <option value="cinema">Cinema</option>
        <option value="letteratura">Letteratura</option>
        <option value="curiosita">Curiosità</option>
      </select>
    </label><br><br>
    <input id="new-question" placeholder="Testo della domanda" style="width:90%"><br><br>
    <input id="ans1" placeholder="Risposta 1"><br>
    <input id="ans2" placeholder="Risposta 2"><br>
    <input id="ans3" placeholder="Risposta 3"><br>
    <input id="ans4" placeholder="Risposta 4"><br><br>
    Corretta: <select id="new-correct"><option value="0">1</option><option value="1">2</option><option value="2">3</option><option value="3">4</option></select><br><br>
    <button onclick="saveNewQuestion()">Salva</button>
    <button onclick="backToMenu()">Torna al Menu</button>
  </div>
</div>

<script>
// Database di base con 10 categorie x 10 domande (per brevità esempio ridotto)
const baseQuestions = {
  cultura: [
    {question:"Qual è il fiume più lungo d’Italia?", answers:["Po","Arno","Tevere","Adige"], correct:0},
    {question:"Chi ha scritto 'La Divina Commedia'?", answers:["Dante","Boccaccio","Manzoni","Tasso"], correct:0},
    {question:"Città famosa per il Carnevale con le maschere?", answers:["Venezia","Roma","Milano","Firenze"], correct:0},
    {question:"Piatto tipico di Napoli?", answers:["Pizza","Risotto","Carbonara","Lasagna"], correct:0},
    {question:"Simbolo di Roma?", answers:["Lupa capitolina","Colosseo","San Marco","Torre di Pisa"], correct:0},
    {question:"Lingua ufficiale in Italia?", answers:["Italiano","Latino","Francese","Inglese"], correct:0},
    {question:"Regione famosa per il vino Chianti?", answers:["Toscana","Piemonte","Veneto","Lombardia"], correct:0},
    {question:"Chi dipinse la Cappella Sistina?", answers:["Michelangelo","Raffaello","Leonardo","Caravaggio"], correct:0},
    {question:"Capitale d'Italia?", answers:["Roma","Milano","Napoli","Torino"], correct:0},
    {question:"Isola più grande d’Italia?", answers:["Sicilia","Sardegna","Elba","Capri"], correct:0}
  ],
  storia: [
    {question:"In che anno cadde l’Impero Romano d’Occidente?", answers:["476","410","1492","800"], correct:0},
    {question:"Chi fu il primo re d’Italia?", answers:["Vittorio Emanuele II","Umberto I","Napoleone","Garibaldi"], correct:0},
    {question:"Chi era Giulio Cesare?", answers:["Generale romano","Re etrusco","Papa","Filosofo"], correct:0},
    {question:"Quale popolo fondò Cartagine?", answers:["Fenici","Greci","Romani","Egizi"], correct:0},
    {question:"Chi scoprì l’America?", answers:["Cristoforo Colombo","Magellano","Vespucci","Cook"], correct:0},
    {question:"Quando iniziò la Prima Guerra Mondiale?", answers:["1914","1918","1939","1945"], correct:0},
    {question:"Chi era Napoleone?", answers:["Imperatore francese","Re d’Italia","Filosofo","Poeta"], correct:0},
    {question:"Dove nacque la democrazia?", answers:["Atene","Roma","Sparta","Firenze"], correct:0},
    {question:"Anno della Rivoluzione Francese?", answers:["1789","1815","1848","1492"], correct:0},
    {question:"Chi era Garibaldi?", answers:["Eroe dei due mondi","Pittore","Re","Filosofo"], correct:0}
  ]
  // -> Aggiungere altre 8 categorie con 10 domande ciascuna per completare le 100
};

let currentSet = [];
let currentQuestion = 0;
let tokens = 0;
let timer;
let timeLeft = 20;

// Utility
function shuffle(array){
  return array.sort(()=>Math.random()-0.5);
}

// Salva e carica nuove domande
function getQuestions(){
  let extra = JSON.parse(localStorage.getItem("extraQuestions")||"{}");
  let all = JSON.parse(JSON.stringify(baseQuestions));
  for(const cat in extra){
    if(!all[cat]) all[cat]=[];
    all[cat] = all[cat].concat(extra[cat]);
  }
  return all;
}

function saveNewQuestion(){
  let cat=document.getElementById("new-category").value;
  let q=document.getElementById("new-question").value;
  let a1=document.getElementById("ans1").value;
  let a2=document.getElementById("ans2").value;
  let a3=document.getElementById("ans3").value;
  let a4=document.getElementById("ans4").value;
  let correct=parseInt(document.getElementById("new-correct").value);
  if(!q||!a1||!a2||!a3||!a4) return alert("Compila tutti i campi");
  let extra=JSON.parse(localStorage.getItem("extraQuestions")||"{}");
  if(!extra[cat]) extra[cat]=[];
  extra[cat].push({question:q, answers:[a1,a2,a3,a4], correct:correct});
  localStorage.setItem("extraQuestions",JSON.stringify(extra));
  alert("Domanda salvata!");
  backToMenu();
}

// Navigazione
function backToMenu(){
  document.getElementById("menu").classList.remove("hidden");
  document.getElementById("add-question").classList.add("hidden");
  document.getElementById("status").classList.add("hidden");
  document.getElementById("help-container").classList.add("hidden");
  document.getElementById("question-container").innerHTML="";
}

function showAddQuestion(){
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("add-question").classList.remove("hidden");
}

// Modalità di gioco
function startQuickGame(){
  let all=getQuestions();
  let pool=[];
  for(const cat in all){ pool=pool.concat(all[cat]); }
  currentSet=shuffle(pool).slice(0,20);
  startGame();
}

function chooseCategory(){
  let all=getQuestions();
  let cats=Object.keys(all);
  let html="<h3>Scegli Categoria</h3>";
  cats.forEach(c=>{ html+=`<button onclick="startCategory('${c}')">${c}</button>`; });
  document.getElementById("menu").innerHTML=html+'<br><button onclick="location.reload()">Torna indietro</button>';
}

function startCategory(cat){
  let all=getQuestions();
  currentSet=shuffle(all[cat]).slice(0,20);
  startGame();
}

function startCareer(){
  // semplice versione carriera -> domande casuali con punteggio salvato
  let score=parseInt(localStorage.getItem("careerScore")||"0");
  alert("Carriera iniziata! Punteggio attuale: "+score);
  startQuickGame();
}

function startGame(){
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("status").classList.remove("hidden");
  document.getElementById("help-container").classList.remove("hidden");
  tokens=0; currentQuestion=0;
  showQuestion();
}

function showQuestion(){
  if(currentQuestion>=currentSet.length){
    document.getElementById("question-container").innerHTML=`<h2>Quiz Terminato!</h2><p>Gettoni totali: ${tokens}</p><button onclick='backToMenu()'>Torna al Menu</button>`;
    document.getElementById("help-container").classList.add("hidden");
    return;
  }
  const q=currentSet[currentQuestion];
  document.getElementById("question-container").innerHTML=`<h2>${q.question}</h2>${q.answers.map((ans,i)=>`<button class="answer-btn" onclick="checkAnswer(${i})">${ans}</button>`).join("")}`;
  document.getElementById("tokens").innerText=`Gettoni: ${tokens}`;
  timeLeft=20;
  document.getElementById("timer").innerText=`Tempo: ${timeLeft}`;
  clearInterval(timer);
  timer=setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").innerText=`Tempo: ${timeLeft}`;
    if(timeLeft<=0){
      clearInterval(timer);
      currentQuestion++;
      showQuestion();
    }
  },1000);
}

function checkAnswer(selected){
  clearInterval(timer);
  const q=currentSet[currentQuestion];
  const buttons=document.querySelectorAll(".answer-btn");
  buttons.forEach((btn,i)=>{
    if(i===q.correct) btn.classList.add("correct");
    else if(i===selected) btn.classList.add("wrong");
    btn.disabled=true;
  });
  if(selected===q.correct) tokens+=10;
  else tokens-=5;
  setTimeout(()=>{
    currentQuestion++;
    showQuestion();
  },1000);
}

function useFiftyFifty(){
  if(tokens<20) return alert("Non hai abbastanza gettoni!");
  tokens-=20;
  const q=currentSet[currentQuestion];
  const buttons=document.querySelectorAll(".answer-btn");
  let wrongs=[...buttons].map((b,i)=>i).filter(i=>i!==q.correct);
  wrongs.sort(()=>0.5-Math.random()).slice(0,2).forEach(i=>buttons[i].style.display="none");
  document.getElementById("tokens").innerText=`Gettoni: ${tokens}`;
}

function useCorrectAnswer(){
  if(tokens<100) return alert("Non hai abbastanza gettoni!");
  tokens-=100;
  checkAnswer(currentSet[currentQuestion].correct);
  document.getElementById("tokens").innerText=`Gettoni: ${tokens}`;
}
</script>
</body>
</html>
